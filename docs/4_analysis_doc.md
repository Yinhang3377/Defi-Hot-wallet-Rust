# 4 — Analysis & Requirements（需求拆解）

目录
- [项目概述](#项目概述)
- [目标与交付](#目标与交付)
- [用户场景](#用户场景)
- [功能需求](#功能需求)
  - [核心功能](#核心功能)
  - [安全功能](#安全功能)
  - [扩展功能](#扩展功能)
- [风险点](#风险点)
- [应对措施](#应对措施)
- [优先级与时间线](#优先级与时间线)
- [交付物](#交付物)
- [成功标准](#成功标准)
- [附注](#附注)

## 项目概述
- 项目名称：DeFi 级热钱包（hot_wallet）  
- 目标：开发一个面向 DeFi 场景的高安全、高可用热钱包，支持资产存取、合约交互、备份恢复与审计能力。  
- 目标用户：个人 DeFi 用户、交易者、DApp 开发者。  
- 时间预算：40 天（MVP 30 天 + 优化 10 天）。  
- 简要 ROI 预期（示例）：6 个月内争取 10 万活跃用户，交易量 1 亿美元，平台抽佣 0.1%。

## 目标与交付
- 近期目标（MVP）：实现助记词生成/导入、助记词分片恢复、ETH 转账（测试链）、基础签名与加密。  
- 中期目标：引入 HSM/软 HSM、2FA、多签与端到端加密。  
- 长期目标：量子安全选项、行为分析、审计与监控、合约自动化审计。

## 用户场景
1. 新用户注册：生成 BIP-39 助记词（支持中文）、导出并通过 Shamir 分片备份到多个持有方。  
2. 资产转账：用户发起 ETH/ERC-20 转账或调用 DeFi 合约，签名通过本地 HSM/多签策略。  
3. 智能合约交互：开发者或高级用户调用质押/借贷合约，系统提供合约审计提示与可升级合约支持。  
4. 数据安全与恢复：用户丢失设备后，通过分片恢复或分布式备份快速恢复钱包与资产。

## 功能需求

### 核心功能
- 钱包创建：BIP-39 助记词（中文支持）、种子派生。  
- 存币/转账：支持 ETH 与常见 ERC-20，集成主流 RPC（Infura、Alchemy 或自建节点）。  
- 备份恢复：Shamir 分片（示例 2-of-3）并支持恢复流程。

### 安全功能
- KDF：Argon2（或可配置的 PBKDF2），参数文档化。  
- 密钥存储：软 HSM 接口（trait）与可选硬件集成（手机安全区/外置 HSM）。  
- 通信与存储加密：AES-256-GCM / TLS1.3。  
- 多重签名：支持 2-of-3 多签工作流。  
- 2FA：TOTP / 生物识别支持。  
- 量子安全（可选）：通过 liboqs 集成 Kyber/Dilithium 方案。  
- 日志与监控：加密日志、可验证审计记录与实时告警。  
- 智能合约审计：集成静态分析（如 Slither）与自动扫描流水线。

### 扩展功能
- 多语言（中/英）、多币种（SOL 等）扩展能力。  
- 分布式备份：IPFS/Arweave（对备份内容先加密）。  
- 插件 / DApp 接入：安全沙箱与权限治理。  
- 节点自动切换与高可用策略。

## 风险点
- 技术风险：助记词分片恢复失败（用户资产丢失）；量子加密性能对低端设备影响。  
- 安全风险：内存敏感数据未及时清零（zeroize）；合约漏洞（重入等）。  
- 合规风险：KYC/AML 要求、日志保留与隐私法规（GDPR）。  
- 用户体验风险：多签/分片流程复杂导致用户流失。

## 应对措施
- 恢复测试：对助记词分片与恢复进行大量自动化模拟（≥100 次）。  
- 内存安全：集成 zeroize，敏感数据生命周期管理。  
- 审计与检测：自动化合约静态分析 + 第三方审计。  
- 合规预留：设计可插拔的 KYC/AML 接口与最小化日志策略（加密存储）。  
- UX 优化：引导式恢复、简化多签流程、一键分片分享模板。

## 优先级与时间线
- 核心（优先级最高，0–30 天）：助记词生成/恢复、KDF 实现、软 HSM、基础转账（测试链）、单元测试与 CI。  
- 增强（并行，第 31–35 天）：多签、2FA、端到端加密、日志审计。  
- 优化（第 36–40 天）：量子选项探试、分布式备份、行为分析与监控规则调优。

## 交付物
- 可运行 MVP：支持 ETH 转账、助记词恢复的代码库与二进制。  
- 文档：用户手册（中/英）、开发与运维文档、KDF/参数说明。  
- 安全材料：测试报告、审计清单、威胁模型与缓解措施。  
- CI 配置：自动化测试与基本静态检查（rustfmt, clippy, cargo test）。

## 成功标准
- 功能：钱包创建、转账与助记词恢复通过率 100%（测试场景）。  
- 性能：普通转账延迟 < 2s（本地/测试链测得）。  
- 安全：关键路径自动化测试覆盖率达到既定阈值；内存敏感数据使用 zeroize。  
- 运维：CI 在每次 PR 执行格式化与测试，主分支保持绿色。

## 附注
- 建议：在开发初期使用软 HSM 模拟并编写兼容接口，后期逐步接入真实 HSM。  
- 文档维护：在每次需求变更后更新此文件并记录“最后修改时间 / 修改人”。  
- 下步行动：将核心任务拆为可导入任务管理系统（Trello/Jira）并开始实现 KDF 与助记词分片模块。

最后修改：请在每次保存时写入时间戳与责任人以便追踪。